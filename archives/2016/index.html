
<!DOCTYPE html>
<html lang="null">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Roubao1994">
    <title>所有文章: 2016 - Roubao1994</title>
    <meta name="author" content="Roubao">
    
    
    
    <meta name="description" content="励志称为最会写代码的大厨">
<meta property="og:type" content="blog">
<meta property="og:title" content="Roubao1994">
<meta property="og:url" content="http://roubao1994.github.io/archives/2016/index.html">
<meta property="og:site_name" content="Roubao1994">
<meta property="og:description" content="励志称为最会写代码的大厨">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Roubao1994">
<meta name="twitter:description" content="励志称为最会写代码的大厨">
    
    
        
    
    
        <meta property="og:image" content="http://img0.imgtn.bdimg.com/it/u=1145521169,539945887&amp;fm=21&amp;gp=0.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ejlztp1tasruqfvoz6xmgqng0anzae8ox7cqjj5yibieqgcmhe9fwxfae6zj.min.css" type="text/css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Roubao1994</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="/#about">
        
        
            <img class="header-picture" src="http://img0.imgtn.bdimg.com/it/u=1145521169,539945887&amp;fm=21&amp;gp=0.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="http://img0.imgtn.bdimg.com/it/u=1145521169,539945887&amp;fm=21&amp;gp=0.jpg"/>
            </a>
            <span class="sidebar-profile-name">Roubao</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首頁</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分類</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">標籤</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">所有文章</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜尋</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">關於</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">Atom</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/02/01/Using-Scrapy/">
                            Using Scrapy
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Feb 01 2016 18:19:48 GMT+0800">
	
		    Feb 01, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Scrapy</span><br></pre></td></tr></table></figure>
<h2 id="u521B_u5EFA_u4E00_u4E2A_u65B0_u9879_u76EE"><a href="#u521B_u5EFA_u4E00_u4E2A_u65B0_u9879_u76EE" class="headerlink" title="创建一个新项目"></a>创建一个新项目</h2><p>该项目从环境保护部爬取过去一个月的城市环境监测数据，空气质量指数（AQI）等等。<br>数据来源：<a href="http://datacenter.mep.gov.cn/report/air_daily/air_dairy.jsp" target="_blank" rel="external">中华人民共和国环境保护部数据中心</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject tutorial</span><br></pre></td></tr></table></figure></p>
<p>该命令会形成一个如下的目录：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tutorial/</span><br><span class="line">    scrapy<span class="class">.cfg</span></span><br><span class="line">    tutorial/</span><br><span class="line">        __init__<span class="class">.py</span></span><br><span class="line">        items<span class="class">.py</span></span><br><span class="line">        pipelines<span class="class">.py</span></span><br><span class="line">        settings<span class="class">.py</span></span><br><span class="line">        spiders/</span><br><span class="line">            __init__<span class="class">.py</span></span><br><span class="line">            ...</span><br></pre></td></tr></table></figure></p>
<p>在spiders下放置spider代码<br>items.py定义item的数据结构<br>pipelines.py对item进行处理，可以在其中将item导入到数据库中，转换成json格式并存取等等<br>settings.py中定义配置常量<br>scrapy.cfg是项目的配置文件</p>
<h2 id="u5B9A_u4E49Item"><a href="#u5B9A_u4E49Item" class="headerlink" title="定义Item"></a>定义Item</h2><p>是爬取到的数据的容器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define here the models for your scraped items</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># http://doc.scrapy.org/en/latest/topics/items.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    id = scrapy.Field()</span><br><span class="line">    name = scrapy.Field()</span><br><span class="line">    date = scrapy.Field()</span><br><span class="line">    AQI = scrapy.Field()</span><br><span class="line">    level = scrapy.Field()</span><br><span class="line">    prime = scrapy.Field()</span><br></pre></td></tr></table></figure></p>
<h2 id="u521B_u5EFAspider"><a href="#u521B_u5EFAspider" class="headerlink" title="创建spider"></a>创建spider</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Selector</span><br><span class="line"><span class="keyword">from</span> tutorial.items <span class="keyword">import</span> CityItem</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DmozSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"aqi"</span></span><br><span class="line">    allowed_domains = [<span class="string">"mep.gov.cn"</span>]</span><br><span class="line">    yesterday = (datetime.datetime.now() - datetime.timedelta(days=<span class="number">1</span>)).strftime(<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">    month_before_yesterday = (datetime.datetime.now() - datetime.timedelta(days=<span class="number">31</span>)).strftime(<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">    start_urls = [</span><br><span class="line">        <span class="string">"http://datacenter.mep.gov.cn/report/air_daily/air_dairy.jsp?city=&amp;startdate="</span> + month_before_yesterday + <span class="string">"&amp;enddate="</span> + yesterday + <span class="string">"&amp;page=1"</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        sel = Selector(response)</span><br><span class="line">        cities = sel.css(<span class="string">"#report1 tr"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> city <span class="keyword">in</span> cities:</span><br><span class="line">            item = CityItem()</span><br><span class="line">            item[<span class="string">"id"</span>] = city.css(<span class="string">":nth-child(1)::text"</span>).extract()</span><br><span class="line">            item[<span class="string">"name"</span>] = city.css(<span class="string">":nth-child(2)::text"</span>).extract()</span><br><span class="line">            item[<span class="string">"date"</span>] = city.css(<span class="string">":nth-child(3)::text"</span>).extract()</span><br><span class="line">            item[<span class="string">"AQI"</span>] = city.css(<span class="string">":nth-child(4)::text"</span>).extract()</span><br><span class="line">            item[<span class="string">"level"</span>] = city.css(<span class="string">":nth-child(5)::text"</span>).extract()</span><br><span class="line">            item[<span class="string">"prime"</span>] = city.css(<span class="string">":nth-child(6)::text"</span>).extract()</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line">        next_page = int(sel.css(<span class="string">"#report1 tr:nth-last-child(2) input:first-child::attr(value)"</span>)[<span class="number">0</span>].extract()) + <span class="number">1</span></span><br><span class="line">        total_page = int(sel.css(<span class="string">"#report1 tr:nth-last-child(2) td:first-child font::text"</span>)[<span class="number">1</span>].extract())</span><br><span class="line">        <span class="keyword">if</span> next_page &lt;= total_page:</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(</span><br><span class="line">                url=<span class="string">"http://datacenter.mep.gov.cn/report/air_daily/air_dairy.jsp?city=&amp;startdate="</span> + self.month_before_yesterday + <span class="string">"&amp;enddate="</span> + self.yesterday + <span class="string">"&amp;page="</span> + str(</span><br><span class="line">                    next_page), callback=self.parse)</span><br></pre></td></tr></table></figure>
<p>name: 用于区别Spider， 每个Spider的名字不同<br>start_urls: 爬虫的起始url,可以有多个起始url<br>allowed_domains: 允许的域名，在爬虫过程中不符合域名要求的会被过滤掉</p>
<p>parse(): Spider的一个方法，默认被调用。</p>
<p>Selector是Spider的一个选择器，可以用XPath或者css来进行DOM的选择。</p>
<h2 id="pipeLine"><a href="#pipeLine" class="headerlink" title="pipeLine"></a>pipeLine</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> twisted.enterprise <span class="keyword">import</span> adbapi</span><br><span class="line"><span class="keyword">from</span> scrapy.exceptions <span class="keyword">import</span> DropItem</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">import</span> MySQLdb.cursors</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonWriterPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.file = codecs.open(<span class="string">"cities.json"</span>, <span class="string">"wb"</span>, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(item[<span class="string">'id'</span>]) &gt; <span class="number">0</span> <span class="keyword">and</span> item[<span class="string">'id'</span>][<span class="number">0</span>].isdigit():</span><br><span class="line">            line = json.dumps(dict(item), ensure_ascii=<span class="keyword">False</span>) + <span class="string">"\n"</span></span><br><span class="line">            self.file.write(line)</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> DropItem(<span class="string">'not a city!'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spider_closed</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MysqlPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dbpool)</span>:</span></span><br><span class="line">        self.dbpool = dbpool</span><br><span class="line"></span><br><span class="line"><span class="decorator">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_settings</span><span class="params">(cls, settings)</span>:</span></span><br><span class="line">        dbargs = dict(</span><br><span class="line">            host=settings[<span class="string">"MYSQL_HOST"</span>],</span><br><span class="line">            db=settings[<span class="string">"MYSQL_DBNAME"</span>],</span><br><span class="line">            user=settings[<span class="string">"MYSQL_USER"</span>],</span><br><span class="line">            passwd=settings[<span class="string">"MYSQL_PASSWORD"</span>],</span><br><span class="line">            cursorclass=MySQLdb.cursors.DictCursor,</span><br><span class="line">            charset=<span class="string">"utf8"</span>,</span><br><span class="line">            use_unicode=<span class="keyword">True</span></span><br><span class="line">        )</span><br><span class="line">        dbpool = adbapi.ConnectionPool(<span class="string">'MySQLdb'</span>, **dbargs)</span><br><span class="line">        <span class="keyword">return</span> cls(dbpool)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        d = self.dbpool.runInteraction(self._do_insert, item, spider)</span><br><span class="line">        d.addErrback(self._handle_error, item, spider)</span><br><span class="line">        d.addBoth(<span class="keyword">lambda</span> _: item)</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_handle_error</span><span class="params">(self, failure, item, spider)</span>:</span></span><br><span class="line">        logging.log(failure)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="string">"""</span><br><span class="line">        things to do before open spider</span><br><span class="line">        :param spider:</span><br><span class="line">        :return:</span><br><span class="line">        """</span></span><br><span class="line">        d = self.dbpool.runInteraction(self._drop_table)</span><br><span class="line">        d = self.dbpool.runInteraction(self._create_table)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_drop_table</span><span class="params">(self, conn)</span>:</span></span><br><span class="line">        conn.execute(<span class="string">"""</span><br><span class="line">        DROP table if EXISTS `city_daily_aqi`</span><br><span class="line">                     """</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_create_table</span><span class="params">(self, conn)</span>:</span></span><br><span class="line">        conn.execute(<span class="string">"""</span><br><span class="line">        CREATE TABLE `city_daily_aqi` (</span><br><span class="line">        `id` int(11) NOT NULL,</span><br><span class="line">        `name` varchar(45) DEFAULT NULL,</span><br><span class="line">        `date` datetime DEFAULT NULL,</span><br><span class="line">        `AQI` varchar(45) DEFAULT NULL,</span><br><span class="line">        `level` varchar(45) DEFAULT '污染等级',</span><br><span class="line">        `prime` varchar(45) DEFAULT '首要污染物',</span><br><span class="line">        PRIMARY KEY (`id`)</span><br><span class="line">        ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line">        """</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_do_insert</span><span class="params">(self, conn, item, spider)</span>:</span></span><br><span class="line">        id = item[<span class="string">"id"</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> id.isdigit():</span><br><span class="line">            name = item[<span class="string">"name"</span>][<span class="number">0</span>] <span class="keyword">if</span> len(item[<span class="string">"name"</span>]) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">            date = item[<span class="string">"date"</span>][<span class="number">0</span>] <span class="keyword">if</span> len(item[<span class="string">"date"</span>]) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">            AQI = item[<span class="string">"AQI"</span>][<span class="number">0</span>] <span class="keyword">if</span> len(item[<span class="string">"AQI"</span>]) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">            level = item[<span class="string">"level"</span>][<span class="number">0</span>] <span class="keyword">if</span> len(item[<span class="string">"level"</span>]) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">            prime = item[<span class="string">"prime"</span>][<span class="number">0</span>] <span class="keyword">if</span> len(item[<span class="string">"prime"</span>]) &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">            conn.execute(<span class="string">"""</span><br><span class="line">            insert into city_daily_aqi (id, name, date, AQI, level, prime)</span><br><span class="line">            VALUES</span><br><span class="line">            (%s, %s, %s, %s, %s, %s)</span><br><span class="line">            """</span>, (id, name, date, AQI, level, prime))</span><br></pre></td></tr></table></figure>
<h3 id="u914D_u7F6Esettings-py"><a href="#u914D_u7F6Esettings-py" class="headerlink" title="配置settings.py"></a>配置settings.py</h3><p>配置PipeLine<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configure item pipelines</span></span><br><span class="line"><span class="comment"># See http://scrapy.readthedocs.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="comment">#'tutorial.pipelines.JsonWriterPipeline': 300,</span></span><br><span class="line">   <span class="string">'tutorial.pipelines.MysqlPipeline'</span>: <span class="number">300</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置MySql<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySql configure settings</span></span><br><span class="line">MYSQL_HOST = <span class="string">'localhost'</span></span><br><span class="line">MYSQL_DBNAME = <span class="string">'aqi'</span></span><br><span class="line">MYSQL_USER = <span class="string">'root'</span></span><br><span class="line">MYSQL_PASSWORD = <span class="string">''</span></span><br><span class="line"><span class="comment"># End of MySql setting</span></span><br></pre></td></tr></table></figure></p>
<h2 id="u6267_u884C"><a href="#u6267_u884C" class="headerlink" title="执行"></a>执行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl aqi</span><br></pre></td></tr></table></figure>
<p>如果嫌弃命令行的debug信息，可以执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl aqi --nolog</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/city_aqi.png" alt="最终结果"></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/02/01/Using-Scrapy/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/29/Mock-in-Python-patch/">
                            Mock in Python: patch
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Fri Jan 29 2016 14:11:34 GMT+0800">
	
		    Jan 29, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p><strong>单元测试中Python独特的有用的技巧——暂时改变resource的行为</strong><br>有时候，你需要一个resource在某个test中表现不一样，并且这种改变只是暂时的，以免它影响其它不相关的test. 为了暂时改变某个资源的行为，你可以使用patching，一个在Python Mock模块中的能力，关于Python Mock 我在上篇文章中已经解释过了。<br>在这篇文章中，我会解释关于mock patching的机制，并且阐述四种类型的patch装饰器，然后展示几种运用patch的方式。我同样会解释MagicMock，以及它在patching中所扮演的角色。<br>代码与Python 2.x 兼容，同时使用Mock 1.0.1, 假设读者已经有了很好的Python， Mock， 基本单元测试的基础。</p>
<h2 id="Patch_u7684_u539F_u56E0"><a href="#Patch_u7684_u539F_u56E0" class="headerlink" title="Patch的原因"></a>Patch的原因</h2><p>假设你希望一个resource在某个时候抛出一个error或者exception，你会试着去改变resource的源代码，但是这意味着对源代码的独占访问，在商业产品中是不可能的。 如果你确实可以获得源代码，改变source会导致overhead。 你需要找到合适的代码并且决定要做哪些改变。 你需要重构resource，解决出现的各种errors, 并且测试你的改变是否如你预料一样运行正常，并且你没有破坏其他部分。</p>
<p>一个更好更安全的方法就是使用mock。 mock取代了test resource,并且提供了相同的方法接口。 你可以让每个方法返回一个值，或者抛出一个eroor/exception。 并且你可以很简单的定制mock来满足特定的test或者test routine。 这种定制化尤其是需要暂时的时候，就是需要patching的时候。 它会在很多情形下发生，例如，强制一个不正常的condition或behavior以让你来测试它，无需为了某个简单的行为创建一个全新的mock对象。</p>
<h2 id="Patch_u88C5_u9970_u5668"><a href="#Patch_u88C5_u9970_u5668" class="headerlink" title="Patch装饰器"></a>Patch装饰器</h2><p>Mock模块使用了四种装饰器来patch一个resource。 装饰器是特定的方法，它们将被patch的resource作为一个mock,分离的对象，或者类来返回。</p>
<ul>
<li>核心装饰器patch是最常用的。它有很多参数，target参数是必须的<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch(target, new = DEFAULT, spec|spec_set = <span class="keyword">None</span>, new_callable = <span class="keyword">None</span>, autospec = <span class="keyword">None</span>,**kwArgs)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<span class="highlight-text yellow">target</span>参数指的是patch的目标，它可以是一个类也可以是一个mock对象。 如果class是一个单独的文件，那么通过 package.module.ClassName传入；如果class在和装饰器相同的文件中，通过 '__main__.ClassName'传入。

<span class="highlight-text yellow">spec/spec_set</span>参数设置了patching的属性。 这些属性可以从一个名字列表或者一个类中获得。省略spec和spec_set告诉核心装饰器使用target的属性。<br><br><span class="highlight-text yellow">autospec</span>参数是设置属性的另一种方法。 传递一个arbitratory Object进来， 被patch的resource会拿到这个object的属性。 传递True进来， 被patch的resource使用target的属性

<span class="highlight-text yellow">new</span>参数设置了被patch的resource的基础。 它可以是一个类， 对象或者是另一个mock对象。 如果省略， 那么装饰器使用MagicMock类来构建resource。<br><br><span class="highlight-text yellow">new_callable</span> 参数也设置patched resource的基础。 但是这个class/object必须是可被调用的。即它实现了magic method __call__(). 同样，它默认使用MagicMock

最后， <span class="highlight-text yellow">kwArgs</span>参数使用了字典作为属性的来源。 与spec， spec_set或者autospec不同， kwArgs还设置了每个attribute的初始值。 每个dictionary entry由属性名和patch value组成。<br><br>* patch.object 装饰器是另一个构建patched resource的装饰器。它和核心装饰器有着相同的参数。这个装饰器需要至少两个参数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch.object(target, attribute, [value, ...])</span><br></pre></td></tr></table></figure>
<span class="highlight-text yellow">target</span>参数是指目标源， <span class="highlight-text yellow">attribute</span>是指被patch的属性。可选参数value是分配给属性的值。其他的六个可选属性与上一个decorator相同。

* patch.dict装饰器使用了字典对象作为目标
<!--￼2-->

<span class="highlight-text yellow">values</span>参数是一系列的注入到目标的key/value对。<br><span class="highlight-text yellow">optional</span>参数重置了目标， 在patch之前去除了所有的entry.
<span class="highlight-text yellow">kwArgs</span> 参数是另一个字典，它的entry被注入到目标中。<br><br>* patch.multiple装饰器使得你可以一次性的patch多个目标resource<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch.multiple(target, mock1 = DEFAULT,...,mockN = DEFAULT, [spec|spec_set = <span class="keyword">None</span>, autospec = <span class="keyword">None</span>, new_callable = <span class="keyword">None</span>, **kwArgs])</span><br></pre></td></tr></table></figure>
<p><span class="highlight-text yellow">target</span> 参数设置了目标源的位置。<br>同样，如果resource与装饰器在同一文件中，设置参数为 “<strong>main</strong>“。 mock1 …… mockN都是target.<br>设置target为DEFAULT生成一个MagicMock实例， 与target的属性相同。<br>设置target为某个类产生一个可被调用的类。<br>patch.multiple装饰器使用了与核心装饰器相同的参数，但是patch.multiple将这些参数应用到所有的target上。</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/01/29/Mock-in-Python-patch/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/25/Mock-in-Python-Mock-Class/">
                            Mock in Python: Mock Class
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Jan 25 2016 18:19:31 GMT+0800">
	
		    Jan 25, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="The_Mock_Class"><a href="#The_Mock_Class" class="headerlink" title="The Mock Class"></a>The Mock Class</h2><p>Mock is a flexible mock object intended to replace the use of stubs and test doubles throughout your code. Mocks are callable and create attributes as new mocks when you access them [1]. Accessing the same attribute will always return the same mock. Mocks record how you use them, allowing you to make assertions about what your code has done to them.</p>
<p>Mock 是一个灵活的mock对象，它可以在你的代码中替代stub和test doubles的使用。 Mocks可以被调用，并且创造作为新的mock的属性。 获取相同属性总是返回相同的mock。 Mocks记录了你如何使用它们，允许你确认你的code对他们做了什么。</p>
<p>MagicMock is a subclass of Mock with all the magic methods pre-created and ready to use. There are also non-callable variants, useful when you are mocking out objects that aren’t callable: NonCallableMock and NonCallableMagicMock</p>
<p>The patch() decorators makes it easy to temporarily replace classes in a particular module with a Mock object. By default patch() will create a MagicMock for you. You can specify an alternative class of Mock using the new_callable argument to patch().</p>
<p>MagicMock 是Mock的子类，但是它有预创建的所有magic methods. 同时还有non-callable的变量: NonCallableMock和NonCallableMock， 当你mock不被调用的对象时它们是有用的<br>patch() decorators使用Mock对象替代某个特定模块中的类变得容易。默认地， patch()会为你创建一个MagicMock。 你可以使用new_callable参数来实例化某个Mock类来patch.</p>
<p>以下摘自diabloneo <a href="http://segmentfault.com/a/1190000002965620" target="_blank" rel="external">《python mock 的入门》</a></p>
<p>Mock对象的一般用法是这样的：</p>
<ol>
<li>找到你要替换的对象，这个对象可以是一个类，一个函数或者是一个实例</li>
<li>实例化Mock类，得到一个mock对象，然后设置这个mock对象的行为，比如被调用时返回什么值，被访问成员时返回什么值</li>
<li>使用mock对象替换掉1中的对象</li>
<li>写测试代码</li>
</ol>
<h2 id="u57FA_u672C_u7528_u6CD5"><a href="#u57FA_u672C_u7528_u6CD5" class="headerlink" title="基本用法"></a>基本用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_request</span><span class="params">(url)</span>:</span></span><br><span class="line">  r = requests.get(url)</span><br><span class="line">  <span class="keyword">return</span> r.status_code</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visit_ustack</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">return</span> send_request(<span class="string">'http://www.ustack.com'</span>)</span><br></pre></td></tr></table></figure>
<p>外部模块调用visit_ustack来访问ustack</p>
<p>使用mock对象进行单元测试<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> client</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClient</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_success_request</span><span class="params">(self)</span>:</span></span><br><span class="line">    success_send = mock.Mock(return_value = <span class="string">'200'</span>)</span><br><span class="line">    client.send_request = success_send</span><br><span class="line">    self.assertEquals(client.visit_ustack(), <span class="string">'200'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_fail_request</span><span class="params">(self)</span>:</span></span><br><span class="line">    fail_send = mock.Mock(return_value = <span class="string">'404'</span>)</span><br><span class="line">    client.send_request = fail_send</span><br><span class="line">    self.assertEquals(client.visit_ustack(), <span class="string">'404'</span>)</span><br></pre></td></tr></table></figure></p>
<ol>
<li>找到要替换的对象： 我们要测试的是visit_ustack函数，因此需要替换掉send_request函数</li>
<li>实例化Mock类：函数的第一行</li>
<li>使用mock的对象替换掉一中的对象</li>
<li>assert</li>
</ol>
<h2 id="Mock_u7684_u53C2_u6570"><a href="#Mock_u7684_u53C2_u6570" class="headerlink" title="Mock的参数"></a>Mock的参数</h2><p>class unittest.mock.Mock(spec=None, side_effect=None, return_value=DEFAULT, wraps=None, name=None, spec_set=None, unsafe=False, **kwargs)</p>
<ol>
<li>name  标识一个mock</li>
<li><p>side_effect<br>它可以是一个mock对象被调用时调用的函数，或者是可迭代的（iterable)或者是一个异常（class or instance)<br>If you pass in a function it will be called with same arguments as the mock and unless the function returns the DEFAULT singleton the call to the mock will then return whatever the function returns. If the function returns DEFAULT then the mock will return its normal value (from the return_value).<br>如果你传入的是一个函数，它会以和mock对象相同的参数调用，并且除非这个函数返回DEFAULT，调用mock会返回函数的返回值。如果函数返回DEFAULT，则mock对象会返回它的normal value（从return_value中获取）<br>If you pass in an iterable, it is used to retrieve an iterator which must yield a value on every call. This value can either be an exception instance to be raised, or a value to be returned from the call to the mock (DEFAULT handling is identical to the function case).<br>如果传入一个iterable,那么它会用来获取一个迭代器，这个迭代器每当被调用都要返回一个值。这个值可以是一个被抛出的异常实例，也可以作为mock对象被调用时的返回值（对于DEFAULT的处理与函数一致）</p>
<h3 id="u793A_u4F8B"><a href="#u793A_u4F8B" class="headerlink" title="示例"></a>示例</h3><ul>
<li><p>抛出一个异常（用来测试代码对异常的处理）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mock = Mock(side_effect=Exception(<span class="string">'Boom'</span>))</span><br><span class="line">mock()</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回一组值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mock = Mock()</span><br><span class="line">mock.side_effect = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">mock(), mock(), mock()</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用callable</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mock = Mock(return_value=<span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">side_effect</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> DEFAULT</span><br><span class="line">mock.side_effect = side_effect</span><br><span class="line">mock()</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置None进行clear</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span>m = Mock(side_effect=KeyError, return_value=<span class="number">3</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>m()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ...</span><br><span class="line">KeyError</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>m.side_effect = <span class="keyword">None</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>m()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>return_value</p>
</li>
<li>spec<br>它可以是一个字符串列表，也可以是一个已经存在的对象（一个class或者一个instance），这个对象作为mock对象的specification. 如果你传入的是一个对象，那么会调用该对象的dir方法来得到一个字符串列表（排除不支持的Magic属性和方法）。 获取不在这个list中的属性会抛出AttributeError.<br>如果spec是一个对象（而不是一个字符串列表），那么<strong>class</strong>返回spec对象的class. 这使得mock对象允许进行isinstance()测试。</li>
</ol>
<h2 id="Mock_u65AD_u8A00_u65B9_u6CD5"><a href="#Mock_u65AD_u8A00_u65B9_u6CD5" class="headerlink" title="Mock断言方法"></a>Mock断言方法</h2><ol>
<li><p>assert_called_with(*args, **kwargs)<br>这个方法用来测试mock方法是否获得了正确的参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"></span><br><span class="line"><span class="comment"># the mock object</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">  _foovalue = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">callFoo</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">doFoo</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">mockFoo = Mock(spec = Foo)</span><br><span class="line">mockFoo.doFoo(<span class="string">'a'</span>)</span><br><span class="line">mockFoo.doFoo.assert_called_with(<span class="string">'a'</span>)</span><br><span class="line"><span class="comment">#assertion passes</span></span><br><span class="line">mockFoo.doFoo(<span class="string">'b'</span>)</span><br><span class="line">mockFoo.doFoo.assert_called_with(<span class="string">'a'</span>)</span><br><span class="line"><span class="comment">#assertion fails</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>assert_called_once_with(*args, *kwargs)<br>断言测试对象是否以正确参数调用方法，并且mock方法只被调用一次</p>
</li>
<li><p>assert_any_call(*args, *kwargs)<br>断言测试对象是否以正确参数调用方法，不管mock方法和断言之间有多少其它的调用。与assert_called_once_with和assert_called_with不同， 这两个断言只考虑最近的一次断言。</p>
</li>
<li><p>assert_has_calls(calls, any_order=False)<br>断言测试对象是否调用了一组特定的calls， mock_calls 列表用来判定。<br>如果any_order 设置为false,那么调用的顺序必须相同，在这一组调用的前后可以有其他的calls。<br>如果any_order 设置为true, 那么调用的顺序无所谓，但是不能有其他的calls.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock,call</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">  _foovalue = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">callFoo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">doFoo</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">mockFoo = Mock(spec = Foo)</span><br><span class="line"></span><br><span class="line">mockFoo.callFoo()</span><br><span class="line">mockFoo.doFoo(<span class="string">'a'</span>)</span><br><span class="line">mockFoo.doFoo(<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">fooCalls = [call.callFoo(), call.doFoo(<span class="string">'a'</span>), call.doFoo(<span class="string">'b'</span>)]</span><br><span class="line">mockFoo.assert_has_calls(fooCalls)</span><br><span class="line"><span class="comment">#assert passes</span></span><br><span class="line"></span><br><span class="line">fooCalls = [call.callFoo(), call.doFoo(<span class="string">'b'</span>), call.doFoo(<span class="string">'a'</span>)]</span><br><span class="line">mockFoo.assert_has_calls(fooCalls)</span><br><span class="line"><span class="comment">#Assertion Error</span></span><br><span class="line"></span><br><span class="line">mockFoo.assert_has_calls(fooCalls, any_order=<span class="keyword">True</span>)</span><br><span class="line"><span class="comment">#assert passes</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>assert_not_called(*args, **kwargs)<br>断言mock方法是否从未被调用</p>
</li>
</ol>
<h2 id="u7BA1_u7406Mock"><a href="#u7BA1_u7406Mock" class="headerlink" title="管理Mock"></a>管理Mock</h2><p>Mock类还有一些方法用来管理控制mock对象</p>
<ul>
<li><p>attach_mock</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    _fooValue = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Foo: callFoo__"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_foo</span><span class="params">(self, args)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Foo: doFoo__ input="</span>, args</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span><span class="params">(object)</span>:</span></span><br><span class="line">    _barValue = <span class="number">456</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_bar</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_bar</span><span class="params">(self, args)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mockFoo = Mock(spec=Foo)</span><br><span class="line"><span class="keyword">print</span> mockFoo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mockBar = Mock(spec=Bar)</span><br><span class="line"><span class="keyword">print</span> mockBar</span><br><span class="line"></span><br><span class="line">mockFoo.attach_mock(mockBar, <span class="string">'fooBar'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> mockFoo</span><br><span class="line"><span class="keyword">print</span> mockFoo._fooValue</span><br><span class="line"><span class="keyword">print</span> mockFoo.call_foo()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> mockFoo.fooBar</span><br><span class="line"><span class="keyword">print</span> mockFoo.fooBar._barValue</span><br><span class="line"><span class="keyword">print</span> mockFoo.fooBar.do_bar(<span class="number">111</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>configure_mock<br>这个方法允许你整个地改变你的mock对象。它唯一的参数是一组键值对，每个key对应你想改变的attribute，如果这个mock对象没有你所指定的属性，那么该方法会给这个mock对象增加该属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    _fooValue = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Foo: call_foo..."</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_foo</span><span class="params">(self, args)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Foo: do_foo input="</span>, args</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mockFoo = Mock(spec=Foo, return_value=<span class="number">555</span>)</span><br><span class="line"><span class="keyword">print</span> mockFoo()</span><br><span class="line"><span class="comment"># return 555</span></span><br><span class="line"></span><br><span class="line">mockFoo.configure_mock(return_value=<span class="number">111</span>)</span><br><span class="line"><span class="keyword">print</span> mockFoo()</span><br><span class="line"><span class="comment">#return 111</span></span><br><span class="line"></span><br><span class="line">fooSpec = &#123;<span class="string">'call_foo.return_value'</span>: <span class="string">"narf"</span>, <span class="string">'do_foo.return_value'</span>: <span class="string">"zoo"</span>, <span class="string">'do_foo.side_effect'</span>: StandardError&#125;</span><br><span class="line">mockFoo.configure_mock(**fooSpec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> mockFoo.call_foo()</span><br><span class="line"><span class="comment">#return narf</span></span><br><span class="line"><span class="keyword">print</span> mockFoo.do_foo(<span class="number">345</span>)</span><br><span class="line"><span class="comment">#raise StandardError</span></span><br><span class="line"></span><br><span class="line">fooSpec = &#123;<span class="string">'do_foo.side_effect'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line">mockFoo.configure_mock(**fooSpec)</span><br><span class="line"><span class="keyword">print</span> mockFoo.do_foo(<span class="number">345</span>)</span><br><span class="line"><span class="comment">#return zoo</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>mock_add_spec()<br>给mock对象增加新的属性。 和参数中的spec作用相同，只是它作用在已经存在的对象上，并且会”擦除”对象原先通过构造函数设置的属性。<br>两个参数: spec和spec_set<br>添加的属性默认只读， 如果设置spec_set 为True, 那么这些属性可写。</p>
</li>
<li><p>reset_mock()<br>The last method, resetMock(), puts the mock object back to its pre-test state. It clears the mock’s call statistics and asserts. It does not clear the return_value and side_effect properties for both mock and its method attributes. Do this to reuse the mock and avoid the overhead of creating another mock.<br>将mock对象重置为pre-test状态。<br>清除mock对象的所有调用数据和断言数据。<br>它不会清除return_value和side_effect属性。<br>这个方法可以重用mock对象，避免了再次创建mock对象的麻烦。</p>
</li>
</ul>
<h2 id="u7528Mock_u6765_u6D4B_u8BD5"><a href="#u7528Mock_u6765_u6D4B_u8BD5" class="headerlink" title="用Mock来测试"></a>用Mock来测试</h2><p><img src="http://twimgs.com/ddj/images/article/2014/0514/Python4.gif" alt="Figure"><br>有三个类。<br>Order类是测试的subject，它是一个简单的购买单个物品的order, 从数据源中获得。<br>WareHouse类是测试的resource,它包含一系列的键值对， key是item的名称， value是item的库存。<br>OrderTest类就是测试用例本身</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Order Class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># instance properties</span></span><br><span class="line">    _order_item = <span class="string">'None'</span></span><br><span class="line">    _order_amount = <span class="number">0</span></span><br><span class="line">    _order_filled = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, arg_item, arg_amount)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(arg_item, str):</span><br><span class="line">            <span class="keyword">if</span> len(arg_item) &gt; <span class="number">0</span>:</span><br><span class="line">                self._order_item = arg_item</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> arg_amount &gt; <span class="number">0</span>:</span><br><span class="line">            self._order_amount = arg_amount</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        loc_order = &#123;<span class="string">'item'</span>: self._order_item, <span class="string">'amount'</span>: self._order_amount&#125;</span><br><span class="line">        <span class="keyword">return</span> repr(loc_order)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(self, arg_src)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Order: fill__'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> arg_src <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="keyword">if</span> arg_src.has_inventory(self._order_item):</span><br><span class="line">                    loc_count = arg_src.get_inventory(self._order_item, self._order_amount)</span><br><span class="line">                    self._order_filled = loc_count</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> <span class="string">'inventory item not available'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">'Warehouse not available'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Invalid warehouse'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_filled</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._order_amount == self._order_filled</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Warehouse Class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WareHouse</span><span class="params">(object)</span>:</span></span><br><span class="line">    _house_name = <span class="keyword">None</span></span><br><span class="line">    _house_list = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">warehouse_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._house_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inventory</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._house_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(self, arg_name, arg_list)</span>:</span></span><br><span class="line">        self._house_name = arg_name</span><br><span class="line">        self._house_list = arg_list</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_inventory</span><span class="params">(self, arg_item)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_inventory</span><span class="params">(self, arg_item, arg_amount)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_inventory</span><span class="params">(self, arg_item, arg_amount)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Test class</span></span><br><span class="line"><span class="keyword">from</span> mock <span class="keyword">import</span> Mock, call</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> application.warehouse <span class="keyword">import</span> WareHouse</span><br><span class="line"><span class="keyword">from</span> application.order <span class="keyword">import</span> Order</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderTest</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    foo_source = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"orderTest setup: begin__"</span></span><br><span class="line"></span><br><span class="line">        test_name = self.id().split(<span class="string">"."</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">print</span> test_name</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> test_name == <span class="string">"test_nil_inventory"</span>:</span><br><span class="line">            self.foo_source = Mock(spec=WareHouse, return_value=<span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">elif</span> test_name == <span class="string">'test_order_check'</span>:</span><br><span class="line">            self.foo_source = Mock(spec=WareHouse)</span><br><span class="line">            self.foo_source.has_inventory.return_value = <span class="keyword">True</span></span><br><span class="line">            self.foo_source.get_inventory.return_value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"OrderTest teardown: begin__"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># test how the order object handle the nil inventory</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_nil_inventory</span><span class="params">(self)</span>:</span></span><br><span class="line">        test_order = Order(<span class="string">"mushrooms"</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        test_source = self.foo_source</span><br><span class="line">        test_order.fill(test_source)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> test_source.mock_calls</span><br><span class="line"></span><br><span class="line">        test_calls = [call.has_inventory(<span class="string">"mushrooms"</span>), call.get_inventory(<span class="string">"mushrooms"</span>, <span class="number">10</span>)]</span><br><span class="line">        test_source.assert_has_calls(test_calls)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_order_check</span><span class="params">(self)</span>:</span></span><br><span class="line">        test_order = Order(<span class="string">"mushrooms"</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        test_order.fill(self.foo_source)</span><br><span class="line"></span><br><span class="line">        self.assertFalse(test_order.is_filled())</span><br><span class="line">        self.assertEquals(test_order._order_filled, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.foo_source.has_inventory.assert_called_once_with(<span class="string">"mushrooms"</span>)</span><br><span class="line"></span><br><span class="line">        test_order = Order(<span class="string">"cabbage"</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        test_order.fill(self.foo_source)</span><br><span class="line"></span><br><span class="line">        self.assertEquals(test_order.is_filled())</span><br><span class="line">        self.assertEquals(test_order._order_filled, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/01/25/Mock-in-Python-Mock-Class/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/25/mock-in-python-quick-guide/">
                            mock in python: quick guide
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Jan 25 2016 16:42:43 GMT+0800">
	
		    Jan 25, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Quick_Guide"><a href="#Quick_Guide" class="headerlink" title="Quick Guide"></a>Quick Guide</h1><p>Mock and MagicMock objects create all attributes and methods as you access them and store details of how they have been used. You can configure them, to specify return values or limit what attributes are available, and then make assertions about how they have been used:</p>
<p>Mock和MagicMock对象创建了所有的属性和方法，并且存储了它们该如何使用的细节。你可以通过配置它们来确定返回值或者限制属性的可见性，然后判断它们是如何被使用的。（即配置mock对象，并assert)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> MagicMock</span><br><span class="line"></span><br><span class="line">thing = ProductionClass()</span><br><span class="line"><span class="comment"># config 返回值为3</span></span><br><span class="line">thing.method = MagicMock(return_value=<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 调用方法</span></span><br><span class="line">thing.method(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, key=<span class="string">'value'</span>)</span><br><span class="line">&gt;&gt;<span class="number">3</span></span><br><span class="line"><span class="comment"># assert方法是否是调用的正确的参数</span></span><br><span class="line">thing.method.assert_called_with(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, key=<span class="string">'value'</span>)</span><br></pre></td></tr></table></figure></p>
<p>side_effect allows you to perform side effects, including raising an exception when a mock is called:</p>
<p>sede_effect使得你可以实现sede effects, 包括当mock被调用时抛出一个异常：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mock = Mock(side_effect=KeyError(<span class="string">'foo'</span>))</span><br><span class="line"><span class="comment"># 调用mock时抛出一个异常</span></span><br><span class="line">mock()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ...</span><br><span class="line">KeyError: <span class="string">'foo'</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">values=&#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">side_effect</span><span class="params">(arg)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> values[arg]</span><br><span class="line">mock.side_effect = side_effect</span><br><span class="line">mock(<span class="string">'a'</span>), mock(<span class="string">'b'</span>), mock(<span class="string">'c'</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">mock.side_effect = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">mock(), mock(), mock()</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>Mock has many other ways you can configure it and control its behaviour. For example the spec argument configures the mock to take its specification from another object. Attempting to access attributes or methods on the mock that don’t exist on the spec will fail with an AttributeError.</p>
<p>有很多方法来配置Mock并控制它的行为。例如， spec参数来配置mock从其他对象获取specification. 尝试从mock对象获取在spec中不存在的属性和方法会抛出AttributeError.</p>
<p>The patch() decorator / context manager makes it easy to mock classes or objects in a module under test. The object you specify will be replaced with a mock (or other object) during the test and restored when the test ends:</p>
<p>patch() decorator / context manager 使得在测试中mock模块中的类或对象变得容易。你所指定的对象会在测试中被mock对象（或其他对象）所取代, 并在测试结束后恢复</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"></span><br><span class="line"><span class="decorator">@patch('module.ClassName2')</span></span><br><span class="line"><span class="decorator">@patch('module.ClassName1')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(MockClass1, MockClass2)</span>:</span></span><br><span class="line">  module.ClassName1()</span><br><span class="line">  module.ClassName2()</span><br><span class="line">  <span class="keyword">assert</span> MockClass1 <span class="keyword">is</span> module.ClassName1</span><br><span class="line">  <span class="keyword">assert</span> MockClass2 <span class="keyword">is</span> module.ClassName2</span><br><span class="line">  <span class="keyword">assert</span> MockClass1.called</span><br><span class="line">  <span class="keyword">assert</span> MockClass2.called</span><br></pre></td></tr></table></figure>
<p><strong>Note When you nest patch decorators the mocks are passed in to the decorated function in the same order they applied (the normal python order that decorators are applied). This means from the bottom up, so in the example above the mock for module.ClassName1 is passed in first.<br>With patch() it matters that you patch objects in the namespace where they are looked up. This is normally straightforward, but for a quick guide read where to patch.</strong></p>
<p><strong>注意: 当你使用嵌套的patch decorator时，mock对象传递给被装饰函数的顺序与他们applied的顺序相同（decorator在通常的python中的应用顺序）。这意味着是从下往上的，因此，在上面例子中，module.ClassName1C首先被传递。<br>通过patch(), 它表明你在他们所寻找的命名空间内注入你的对象。这个是很直观的，为了更迅速的了解，你可以阅读<a href="https://docs.python.org/dev/library/unittest.mock.html#where-to-patch" target="_blank" rel="external">where to patch</a></strong></p>
<p>As well as a decorator patch() can be used as a context manager in a with statement:</p>
<p>patch()还可以通过with语句变为上下文管理器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> patch.object(ProductionClass, <span class="string">'method'</span>, return_value=<span class="keyword">None</span>) <span class="keyword">as</span> mock_method:</span><br><span class="line">  thing = ProductionClass</span><br><span class="line">  thing.method(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">mock_method.assert_called_once_with(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>There is also patch.dict() for setting values in a dictionary just during a scope and restoring the dictionary to its original state when the test ends:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">foo = &#123;<span class="string">'key'</span>: <span class="string">'value'</span>&#125;</span><br><span class="line">original = foo.copy()</span><br><span class="line"><span class="keyword">with</span> patch.dict(foo, &#123;<span class="string">'newKey'</span>, <span class="string">'newValue'</span>&#125;, clear=<span class="keyword">True</span>):</span><br><span class="line">  <span class="keyword">assert</span> foo == &#123;<span class="string">'newKey'</span>, <span class="string">'newValue'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> foo == original</span><br></pre></td></tr></table></figure></p>
<p>Mock 支持mock Python magic methods，最简单的使用magic methods的方式是通过MagicMock类. 你可以这么做：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mock = MagicMock()</span><br><span class="line">mock.__str__.return_value = <span class="string">'foobarbaz'</span></span><br><span class="line">str(mock)</span><br><span class="line">mock.__str__.assert_called_with()</span><br></pre></td></tr></table></figure></p>
<p>Mock allows you to assign functions (or other Mock instances) to magic methods and they will be called appropriately. The MagicMock class is just a Mock variant that has all of the magic methods pre-created for you (well, all the useful ones anyway).<br>The following is an example of using magic methods with the ordinary Mock class:</p>
<p>Mock使得你将函数（或者其他Mock实例）assign到magic methods上，并且它们能够被恰当地调用。 MaigicMock类只是一个含有所有magic methods方法的Mock变量。<br>以下是一个通过通常的Mock类使用magic methods的案例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mock = Mock()</span><br><span class="line">mock.__str__ = Mock(return_value=<span class="string">'wheeeee'</span>)</span><br><span class="line">str(mock)</span><br></pre></td></tr></table></figure></p>
<p>For ensuring that the mock objects in your tests have the same api as the objects they are replacing, you can use auto-speccing. Auto-speccing can be done through the autospec argument to patch, or the create_autospec() function. Auto-speccing creates mock objects that have the same attributes and methods as the objects they are replacing, and any functions and methods (including constructors) have the same call signature as the real object.<br>This ensures that your mocks will fail in the same way as your production code if they are used incorrectly:</p>
<p>为了确保你在测试中的mock对象有和它们替代对象相同的api， 你可以使用 <strong>auto-speccing</strong>. Auto-speccing 可以通过autoapec参数或者create_autospec()函数来实现。 Auto-speccing创建了与它们所替代的对象有相同属性和方法的mock对象。<br>这确保了当它们被错误使用时，你的mock对象和你的production code一样也会失败，并且方式一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> create_autospec</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(a, b ,c)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">mock_function = create_autospec(function, return_value=<span class="string">'fishy'</span>)</span><br><span class="line">mock_function(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>fishy</span><br><span class="line">mock_function.assert_called_once_with(<span class="number">1</span>, <span class="number">2</span> ,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">mock_function(<span class="string">'wrong params'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"> ...</span><br><span class="line">TypeError: &lt;<span class="keyword">lambda</span>&gt;() takes exactly <span class="number">3</span> arguments (<span class="number">1</span> given</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/01/25/mock-in-python-quick-guide/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/25/mock-in-python/">
                            mock in python
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Jan 25 2016 16:26:58 GMT+0800">
	
		    Jan 25, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>translated from <a href="http://www.toptal.com/python/an-introduction-to-mocking-in-python" target="_blank" rel="external">An introduction to mocking in python</a>.<br>This is my first post :blush:</p>
<h2 id="An_introduction_to_mocking_in_python"><a href="#An_introduction_to_mocking_in_python" class="headerlink" title="An introduction to mocking in python"></a>An introduction to mocking in python</h2><h3 id="How_to_Run_Unit_Test_Without_Testing_Your_Patience"><a href="#How_to_Run_Unit_Test_Without_Testing_Your_Patience" class="headerlink" title="How to Run Unit Test Without Testing Your Patience"></a>How to Run Unit Test Without Testing Your Patience</h3><p>通常来说，我们所写的软件通常与我们标记为’dirty’的service直接交互。用通俗的话来说：service对我们的应用是至关重要的，但是与它的交互有必须的但不被期望的副作用——在自动化测试中它是不被期望的。<br>例如: 有时候我们需要写一个社交性的app，并且测试我们的’Post to Facebook feature’, 但是并不希望在每次运行test suite时，真正地将它post到Facebook上。</p>
<h3 id="Fear_System_Calls"><a href="#Fear_System_Calls" class="headerlink" title="Fear System Calls"></a>Fear System Calls</h3><p>让我们考虑另外一个例子：system calls, 这个例子也将在接下来的文章中一直被使用。显而易见，以下是我们mock的时候最主要的候选：弹出CD drive的脚本，从/tmp删除cache文件的web服务器，或者是绑定TCP端口的socket server,这些调用都有你在进行单元测试时不想有的上下文中的副作用。</p>
<p><strong>As a developer, you care more that your library successfully called the system function for ejecting a CD as opposed to experiencing your CD tray open every time a test is run. 作为一个开发者，你更关注的是你的library是否成功地调用了系统函数</strong></p>
<p>然而，保持你的单元测试高效意味着减少自动化测试运行中的”slow code”,例如，文件系统和网络连接。</p>
<p>在我们的第一个例子中，我们会refactor一个标准的Python测试用例（使用mock).我们会证明使用mock来撰写测试用例是如何使得我们的测试更加机智快速，并且暴露更多的软件运行过程的细节。</p>
<h3 id="A_Simple_Delete_Function__u4E00_u4E2A_u7B80_u5355_u7684_u5220_u9664_u51FD_u6570"><a href="#A_Simple_Delete_Function__u4E00_u4E2A_u7B80_u5355_u7684_u5220_u9664_u51FD_u6570" class="headerlink" title="A Simple Delete Function 一个简单的删除函数"></a>A Simple Delete Function 一个简单的删除函数</h3><p>我们都需要经常从文件系统中删除文件，所以我们现在写一个Python函数，它会使得我们的脚本更加容易来做这件事。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span><span class="params">(filename)</span>:</span></span><br><span class="line">  os.remove(filename)</span><br></pre></td></tr></table></figure>
<p>显然，当前的rm方法并不比os.remove提供的功能多，但是通过改进codebase，使得我们增加更多的功能。</p>
<p>下面我们来撰写一个传统的测试用例，without mock<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#! -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> mymodule <span class="keyword">import</span> rm</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rmTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">  tmpfilepath = os.path.joint(tmpfile.gettempdir(), <span class="string">'tmp-testfile'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(self.tmpfilepath, <span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">      f.write(<span class="string">'delete me'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_rm</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># remove the file</span></span><br><span class="line">    rm(self.tempfilepath)</span><br><span class="line">    <span class="comment"># test that it was deleted</span></span><br><span class="line">    self.assertFalse(os.path.isfile(self.tempfilepath), <span class="string">'failed to delete file'</span>)</span><br></pre></td></tr></table></figure></p>
<p>这个测试用例很简单，但是每当它运行一次，一个临时文件就被创建继而又被删除。另外，我们并不能测试我们的rm方法是否正确地将参数传递给了os.remove。 我们可以通过上面的测试假设它做到了，但是我们期待测试的更多。</p>
<h3 id="Refactoring_with_Mocks__u901A_u8FC7Mock_u6765_u91CD_u6784"><a href="#Refactoring_with_Mocks__u901A_u8FC7Mock_u6765_u91CD_u6784" class="headerlink" title="Refactoring with Mocks 通过Mock来重构"></a>Refactoring with Mocks 通过Mock来重构</h3><p>让我们通过mock来重构我们的测试用例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#! -*- coding utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mymodule <span class="keyword">import</span> rm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rmTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="decorator">  @mock.patch('mymodule.os')</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_rm</span><span class="params">(self, mock_os)</span>:</span></span><br><span class="line">    rm(<span class="string">"any path"</span>)</span><br><span class="line">    <span class="comment">#test that rm calls os.remove with right params</span></span><br><span class="line">    mock_os.remove.assert_called_with(<span class="string">"any path"</span>)</span><br></pre></td></tr></table></figure></p>
<p>通过这些重构，我们基本上改变了测试的运行方式。现在，我们有一个insider，通过运用它我们可以确认其他的功能性。</p>
<h3 id="Potential_Pitfalls__u6F5C_u5728_u7684_u9677_u9631"><a href="#Potential_Pitfalls__u6F5C_u5728_u7684_u9677_u9631" class="headerlink" title="Potential Pitfalls 潜在的陷阱"></a>Potential Pitfalls 潜在的陷阱</h3><p>首先我们需要指出的是，我们通过mock.patch方法装饰器来mock一个在mymodule.os中的对象，并且把这个mock注入到测试用例中的方法。</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/01/25/mock-in-python/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/01/23/hello-world/">
                            Hello World
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Sat Jan 23 2016 23:18:08 GMT+0800">
	
		    Jan 23, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start"><a href="#Quick_Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create_a_new_post"><a href="#Create_a_new_post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server"><a href="#Run_server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files"><a href="#Generate_static_files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites"><a href="#Deploy_to_remote_sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/01/23/hello-world/#post-footer" class="postShorten-excerpt_link link">
                                留言與分享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 頁 共 1 頁</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Roubao. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://img0.imgtn.bdimg.com/it/u=1145521169,539945887&amp;fm=21&amp;gp=0.jpg"/>
        
            <h4 id="about-card-name">Roubao</h4>
        
            <h5 id="about-card-bio"><p>一只一直在减肥的肉包包</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/scrip-gfmrkxcl0qohe3cfdgxhzvc0yrceqta8i4iix0txvn8q4o2adlqd5n0jmkvt.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->



</html>
